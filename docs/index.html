

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Dodo’s object detection package &mdash; dodo detector 0.8 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Package modules" href="modules.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="#" class="icon icon-home"> dodo detector
          

          
          </a>

          
            
            
              <div class="version">
                0.8
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Package modules</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">dodo detector</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="#" class="icon icon-home"></a> &raquo;</li>
        
      <li>Dodo’s object detection package</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="dodo-s-object-detection-package">
<h1>Dodo’s object detection package<a class="headerlink" href="#dodo-s-object-detection-package" title="Permalink to this headline">¶</a></h1>
<p>This is a package that implements two types of object detection algorithms and provides them as Python classes, ready to be instantiated and used. The first algorithm uses a pipeline which consists of OpenCV keypoint detection and description algorithms, followed by feature matching and positioning using homography. Basically, <a class="reference external" href="https://docs.opencv.org/3.4.1/d1/de0/tutorial_py_feature_homography.html">this tutorial</a>.</p>
<p>The second one uses any pre-trained convolutional network from the <a class="reference external" href="https://github.com/tensorflow/models/tree/master/research/object_detection">TensorFlow Object Detection API</a>. Basically, <a class="reference external" href="https://github.com/tensorflow/models/blob/master/research/object_detection/colab_tutorials/object_detection_tutorial.ipynb">this tutorial</a>.</p>
<p>I’ve made an effort to keep the package compatible with both Python 2.7 and Python 3 (for ROS users) and, consequently, with TensorFlow 1 and 2, and the TensorFlow Object Detection APIs v1 and v2.</p>
<div class="section" id="why">
<h2>Why<a class="headerlink" href="#why" title="Permalink to this headline">¶</a></h2>
<p>After having to follow the same computer vision tutorials to implement object detection every time I needed it for a project, I decided I had enough and created this Python package with detection methods I often use, ready to be used out of the box. I hope this makes things easier not only for me, but for others.</p>
</div>
<div class="section" id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<p>For the keypoint-based object detector:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/opencv/opencv_contrib">OpenCV 3 nonfree/contrib packages</a>, which include the SURF <a class="footnote-reference brackets" href="#id6" id="id1">1</a> and SIFT <a class="footnote-reference brackets" href="#id7" id="id2">2</a> keypoint detection algorithms</p></li>
</ul>
<p>For the TensorFlow-based object detectors:</p>
<ul class="simple">
<li><p>if you plan to run this on ROS, or use Python 2.7, or TensorFlow 1: <a class="reference external" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf1.md">TensorFlow Object Detection API v1</a></p></li>
<li><p>if you plan on running this with TensorFlow 2: <a class="reference external" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/tf2.md">TensorFlow Object Detection API v2</a></p></li>
</ul>
<p>Follow their respective documentation pages to install them.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is an <code class="docutils literal notranslate"><span class="pre">opencv-contrib</span></code> package available on PyPI, but I have never tried installing it instead of doing the aforementioned process.</p>
</div>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>Since this package is not on PyPI, you can install it via <code class="docutils literal notranslate"><span class="pre">pip</span></code> like this:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pip install git+https://github.com/douglasrizzo/dodo_detector.git
</pre></div>
</div>
<p>OpenCV is a hard dependency and is installed via the PyPI <code class="docutils literal notranslate"><span class="pre">opencv-python</span></code> package. If you already have OpenCV installed (<em>e.g.</em> from source), edit <em>setup.py</em> and remove the hard dependency before installing.</p>
<p>As for TensorFlow, either install the specific TensorFlow version that is going to be used, or create a virtualenv to run this package along with your TensorFlow version of choice. Make sure to also have the Object Detection API installed. Only the API compatible with your TensorFlow and Python versions should be on your <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code>.</p>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>The package has two types of detector, a keypoint-based detector and a detector that uses convolutional neural networks from the TensorFlow object detection API.</p>
<p>All detectors have a common interface, with three methods:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">from_camera</span></code> takes a camera ID and uses OpenCV to read a frame stream, which is displayed on a separate window;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">from_video</span></code> receives a video file and also displays the detection results on a window;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">from_image</span></code> receives a single RGB image as a numpy array and returns a tuple containing an image with all the detected objects marked in it, and a dictionary containing object classes as keys and their detection information in tuples. Some classifiers return only bounding boxes, others return an additional confidence level. An example with one apple and two oranges detected in an image:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;person&#39;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="s1">&#39;box&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">204</span><span class="p">,</span> <span class="mi">456</span><span class="p">,</span> <span class="mi">377</span><span class="p">,</span> <span class="mi">534</span><span class="p">),</span> <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="mf">0.9989906</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;box&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">182</span><span class="p">,</span> <span class="mi">283</span><span class="p">,</span> <span class="mi">370</span><span class="p">,</span> <span class="mi">383</span><span class="p">),</span> <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="mf">0.99848276</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;box&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">181</span><span class="p">,</span> <span class="mi">222</span><span class="p">,</span> <span class="mi">368</span><span class="p">,</span> <span class="mi">282</span><span class="p">),</span> <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="mf">0.9979938</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;box&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">184</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">379</span><span class="p">,</span> <span class="mi">109</span><span class="p">),</span> <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="mf">0.9938652</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;box&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">169</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">371</span><span class="p">,</span> <span class="mi">66</span><span class="p">),</span> <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="mf">0.98873794</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;box&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">199</span><span class="p">,</span> <span class="mi">397</span><span class="p">,</span> <span class="mi">371</span><span class="p">,</span> <span class="mi">440</span><span class="p">),</span> <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="mf">0.96926546</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;box&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">197</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">365</span><span class="p">,</span> <span class="mi">191</span><span class="p">),</span> <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="mf">0.96739936</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;box&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">184</span><span class="p">,</span> <span class="mi">363</span><span class="p">,</span> <span class="mi">377</span><span class="p">,</span> <span class="mi">414</span><span class="p">),</span> <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="mf">0.945458</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;box&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">195</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">363</span><span class="p">,</span> <span class="mi">195</span><span class="p">),</span> <span class="s1">&#39;confidence&#39;</span><span class="p">:</span> <span class="mf">0.92953676</span><span class="p">}</span>
<span class="p">]}</span>
</pre></div>
</div>
</li>
</ul>
<div class="section" id="keypoint-based-detector">
<h3>Keypoint-based detector<a class="headerlink" href="#keypoint-based-detector" title="Permalink to this headline">¶</a></h3>
<p>The keypoint-based object detector uses OpenCV 3 keypoint detection and description algorithms (namely, SURF <a class="footnote-reference brackets" href="#id6" id="id3">1</a>, SIFT <a class="footnote-reference brackets" href="#id7" id="id4">2</a> and RootSIFT <a class="footnote-reference brackets" href="#id8" id="id5">3</a>) to extract features from a database of images provided by the user. These features are then compared to features extracted from a target image, using feature matching algorithms also provided by OpenCV, to find the desired objects from the database in the target image.</p>
<p>Since OpenCV has no implementation of RootSIFT, I stole <a class="reference external" href="https://www.pyimagesearch.com/2015/04/13/implementing-rootsift-in-python-and-opencv/">this one</a>.</p>
<p>Example on running a keypoint-based detector:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dodo_detector.detection</span> <span class="kn">import</span> <span class="n">KeypointObjectDetector</span>
<span class="n">detector</span> <span class="o">=</span> <span class="n">KeypointObjectDetector</span><span class="p">(</span><span class="s1">&#39;/path/to/my/database_dir&#39;</span><span class="p">)</span>
<span class="n">marked_image</span><span class="p">,</span> <span class="n">obj_dict</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">from_image</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
</pre></div>
</div>
<p>The database directory must have the following structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">database_dir</span>
    <span class="n">beer_can</span>
        <span class="n">img1</span><span class="o">.</span><span class="n">jpg</span>
        <span class="n">img2</span><span class="o">.</span><span class="n">jpg</span>
        <span class="n">img3</span><span class="o">.</span><span class="n">jpg</span>
    <span class="n">milk_box</span>
        <span class="n">hauihu</span><span class="o">.</span><span class="n">jpg</span>
        <span class="mf">172812.</span><span class="n">jpg</span>
        <span class="n">you_require_additional_pylons</span><span class="o">.</span><span class="n">jpg</span>
    <span class="n">chocolate_milk</span>
        <span class="o">.</span>
        <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
</pre></div>
</div>
<p>Basically, the top-level directory will contain subdirectories. The name of each subdirectory is the class name the program will return during detection. Inside each subdirectory is a collection of image files, whose keypoints will be extracted by the <code class="docutils literal notranslate"><span class="pre">KeypointObjectDetector</span></code> during the object construction. The keypoints will then be kept in-memory while the object exists.</p>
<p>You can then use the methods provided by the detector to detect objects in your images, videos or camera feed.</p>
</div>
<div class="section" id="convolutional-neural-network-detectors">
<h3>Convolutional neural network detectors<a class="headerlink" href="#convolutional-neural-network-detectors" title="Permalink to this headline">¶</a></h3>
<p>These detectors use the TensorFlow Object Detection API. In order to use them, you must either train your own neural network using their API, or provide a trained network. I have a concise <a class="reference external" href="https://gist.github.com/douglasrizzo/c70e186678f126f1b9005ca83d8bd2ce">tutorial</a> on how to train a neural network for TensorFlow 2, with other useful links.</p>
<div class="section" id="python-2-7-or-tensorflow-1">
<h4>Python 2.7 or TensorFlow 1<a class="headerlink" href="#python-2-7-or-tensorflow-1" title="Permalink to this headline">¶</a></h4>
<p>The training procedure will give you the <em>frozen inference graph</em>, which is a <code class="docutils literal notranslate"><span class="pre">.pb</span></code> file; and a <em>label map</em>, which is a text file with extension <code class="docutils literal notranslate"><span class="pre">.pbtxt</span></code> containing the names of your object classes.</p>
<p>This type of detector must be pointed towards the paths for the frozen inference graph and label map. The number of classes is inferred from the contents of the label map.</p>
<p>Example on running the detector:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dodo_detector.detection</span> <span class="kn">import</span> <span class="n">TFObjectDetectorV1</span>
<span class="n">detector</span> <span class="o">=</span> <span class="n">TFObjectDetectorV1</span><span class="p">(</span><span class="s1">&#39;path/to/frozen/graph.pb&#39;</span><span class="p">,</span> <span class="s1">&#39;path/to/labels.pbtxt&#39;</span><span class="p">)</span>
<span class="n">marked_image</span><span class="p">,</span> <span class="n">obj_dict</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">from_image</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="tensorflow-2">
<h4>TensorFlow 2<a class="headerlink" href="#tensorflow-2" title="Permalink to this headline">¶</a></h4>
<p>After training and exporting a model, a directory called <code class="docutils literal notranslate"><span class="pre">saved_model</span></code> will be created, whose contents are used by <em>dodo_detector</em> to load the model into memory. Another file that is needed is the <em>label map</em>, which is a text file with extension <code class="docutils literal notranslate"><span class="pre">.pbtxt</span></code> containing the names of your object classes.</p>
<p>This type of detector must be pointed towards the paths of the <code class="docutils literal notranslate"><span class="pre">saved_model</span></code> directory and label map. The number of classes is inferred from the contents of the label map.</p>
<p>Example on running the detector:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dodo_detector.detection</span> <span class="kn">import</span> <span class="n">TFObjectDetectorV2</span>
<span class="n">detector</span> <span class="o">=</span> <span class="n">TFObjectDetectorV2</span><span class="p">(</span><span class="s1">&#39;path/to/frozen/saved_model&#39;</span><span class="p">,</span> <span class="s1">&#39;path/to/labels.pbtxt&#39;</span><span class="p">)</span>
<span class="n">marked_image</span><span class="p">,</span> <span class="n">obj_dict</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">from_image</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
</pre></div>
</div>
<p>Have fun!</p>
<p class="rubric">References</p>
<dl class="footnote brackets">
<dt class="label" id="id6"><span class="brackets">1</span><span class="fn-backref">(<a href="#id1">1</a>,<a href="#id3">2</a>)</span></dt>
<dd><ol class="upperalpha simple" start="8">
<li><p>Bay, A. Ess, T. Tuytelaars, and L. Van Gool, “Speeded-up robust features (SURF),” Computer vision and image understanding, vol. 110, no. 3, pp. 346–359, 2008.</p></li>
</ol>
</dd>
<dt class="label" id="id7"><span class="brackets">2</span><span class="fn-backref">(<a href="#id2">1</a>,<a href="#id4">2</a>)</span></dt>
<dd><ol class="upperalpha simple" start="4">
<li><ol class="upperalpha simple" start="7">
<li><p>Lowe, “Object recognition from local scale-invariant features,” in Proceedings of the Seventh IEEE International Conference on Computer Vision, 1999, vol. 2, pp. 1150–1157.</p></li>
</ol>
</li>
</ol>
</dd>
<dt class="label" id="id8"><span class="brackets"><a class="fn-backref" href="#id5">3</a></span></dt>
<dd><ol class="upperalpha simple" start="18">
<li><p>Arandjelović and A. Zisserman, “Three things everyone should know to improve object retrieval,” in 2012 IEEE Conference on Computer Vision and Pattern Recognition, 2012, pp. 2911–2918.</p></li>
</ol>
</dd>
</dl>
<div class="toctree-wrapper compound">
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Package modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dodo_detector.html">dodo_detector.detection module</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="modules.html" class="btn btn-neutral float-right" title="Package modules" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Douglas De Rizzo Meneghetti.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>